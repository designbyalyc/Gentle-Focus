<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preload" href="../assets/audio/456.mp3" as="audio">
    <meta name="description" content="Gentle Focus - A calm productivity experience">
    <link rel="dns-prefetch" href="https://cdn.pixabay.com">
  <title>Gentle Focus â€” A Calm Productivity Experience</title>
  <link rel="stylesheet" href="./style.css" />
</head>

<body style="background-color: #e4e9f2;>
  <!-- Focus Bubble Animation -->
  <div class="focus-bubble-container">
    <div class="focus-bubble" id="focusBubble"></div>
  </div>

  <!-- Audio Control -->
  <button class="audio-control" id="audioControl" aria-pressed="false" aria-label="Toggle ambient audio">ðŸ”‡ Unmute Audio</button>
  <audio id="ambientAudio" loop preload="auto" playsinline crossorigin="anonymous" muted>
    <source src="../assets/audio/456.mp3" type="audio/mpeg" />
    <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_4c0c6d718c.mp3" type="audio/mpeg" />
  </audio>

  <script>
    // Smooth Floating Focus Bubble Animation
    const bubble = document.getElementById("focusBubble");
    let x = window.innerWidth / 2 - 125;
    let y = window.innerHeight / 2 - 125;
    let dx = 0.6;
    let dy = 0.4;

    function animateBubble() {
      x += dx;
      y += dy;
      if (x <= 0 || x >= window.innerWidth - 250) dx *= -1;
      if (y <= 0 || y >= window.innerHeight - 250) dy *= -1;
      const hue = (Date.now() / 1500) % 360; // ~90s cycle
      bubble.style.transform = `translate(${x}px, ${y}px) scale(1.02)`;
      bubble.style.background = `radial-gradient(circle at center,
        hsl(${hue}, 85%, 75%),
        hsl(${(hue + 40) % 360}, 70%, 65%))`;
      bubble.style.boxShadow = `0 0 120px hsla(${hue}, 90%, 80%, 0.7),
                                0 0 160px hsla(${(hue + 40) % 360}, 70%, 70%, 0.4)`;
      requestAnimationFrame(animateBubble);
    }
    animateBubble();

    // Audio Control (iOS-friendly priming + mute/unmute toggle)
    const audio = document.getElementById("ambientAudio");
    const btn = document.getElementById("audioControl");
    audio.loop = true;
    audio.preload = "auto";
    audio.volume = 0.2;
    audio.muted = true; // start muted to respect autoplay rules
    let audioPrimed = false;

    function updateButtonState() {
      if (audio.muted) {
        btn.textContent = "ðŸ”‡ Unmute Audio";
        btn.setAttribute('aria-pressed', 'false');
      } else {
        btn.textContent = "ðŸ”Š Mute Audio";
        btn.setAttribute('aria-pressed', 'true');
      }
    }
    updateButtonState();

    // Prime audio on first user gesture to satisfy Safari autoplay
    function primeAudio() {
      if (audioPrimed) return;
      // play while muted to prime decoding and network buffering
      const p = audio.play();
      if (p && p.then) {
        p.then(() => {
          audioPrimed = true;
        }).catch(() => {
          // ignore play errors; some browsers block until user gesture
          audioPrimed = true;
        });
      } else {
        audioPrimed = true;
      }
      // remove listeners
      document.removeEventListener('pointerdown', primeAudio);
      document.removeEventListener('touchstart', primeAudio);
      document.removeEventListener('keydown', primeAudio);
    }
    document.addEventListener('pointerdown', primeAudio, { once: true });
    document.addEventListener('touchstart', primeAudio, { once: true });
    document.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Enter') primeAudio();
    }, { once: true });

    // Toggle via mute/unmute for instant response on iOS
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      // ensure audio primed before unmuting for Safari
      if (!audioPrimed) primeAudio();
      // toggle muted state
      audio.muted = !audio.muted;
      updateButtonState();
    });

    // Optional: ensure seamless loop fallback â€” if loop not supported, restart on ended
    audio.addEventListener('ended', () => {
      if (!audio.loop) {
        audio.currentTime = 0;
        audio.play().catch(()=>{});
      }
    });
  </script>

   <div class="elapsed-time" id="elapsedTime" role="timer" aria-label="Session duration">00:00</div>
</body>

</html>
